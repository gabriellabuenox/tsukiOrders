<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pedido de Brigadeiros</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">
  <style>
    :root{
      --brand:#ff6bb5;        /* rosa chiclete */
      --brand-2:#9b8cff;      /* lilás */
      --bg:#fff7fb;           /* rosinha bem claro */
      --card:#ffffff;
      --text:#2a2a2a;
      --muted:#7b8190;
      --border:#f0e6f1;
      --ring:rgba(255,107,181,.25);
      --ok:#2fbf71;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      color:var(--text); background:
        radial-gradient(1200px 600px at 10% -10%, rgba(255,107,181,.12), transparent 60%),
        radial-gradient(1000px 500px at 110% 0%, rgba(155,140,255,.12), transparent 60%),
        var(--bg);
    }
    .wrap{max-width:980px; margin:24px auto 96px; padding:0 16px}
    .header{
      display:flex; align-items:center; gap:14px; margin-bottom:14px;
      padding:12px 12px; border-radius:16px;
    }
    .logo{
      display:flex; align-items:center; gap:10px;
      background:linear-gradient(135deg, rgba(255,107,181,.12), rgba(155,140,255,.12));
      border:1px solid var(--border);
      padding:10px 12px; border-radius:14px;
      box-shadow:0 6px 20px rgba(0,0,0,.06);
    }
    .logo img{height:36px; width:auto; display:block}
    .brand-title{font-weight:700; letter-spacing:.2px}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:18px; padding:18px;
      box-shadow:0 10px 30px rgba(155,140,255,.08), 0 4px 14px rgba(255,107,181,.08);
      animation: pop .25s ease-out;
    }
    @keyframes pop{from{transform:translateY(4px); opacity:.0} to{transform:none; opacity:1}}
    h1{font-size:24px; margin:0 0 6px}
    h2{font-size:18px; margin:8px 0 10px}
    .muted{color:var(--muted); font-size:13px}

    .grid{display:grid; gap:12px}
    .grid-2{grid-template-columns:1fr 1fr}
    .row{display:grid; grid-template-columns:1fr; gap:10px}
    @media (min-width:760px){ .row.grid-2{grid-template-columns:1fr 1fr} }

    label{font-weight:600; font-size:14px}
    input[type="text"], input[type="date"], select{
      width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; font-size:15px; background:#fff;
      outline:none; transition: box-shadow .15s, border-color .15s, transform .04s;
    }
    input:focus, select:focus{
      border-color:var(--brand); box-shadow:0 0 0 6px var(--ring);
    }
    input[type="number"]{ width:100%; max-width:95px }

    .section{ border:1px dashed var(--border); border-radius:14px; padding:12px; background:#fff; }
    .inline{display:flex; align-items:center; gap:8px}
    .btn{
      appearance:none; border:1px solid var(--border); background:#fff; color:#333;
      border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer;
      transition: transform .06s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .btn:hover{box-shadow:0 8px 18px rgba(155,140,255,.15)}
    .btn:active{transform:translateY(1px)}
    .btn.small{padding:8px 10px; border-radius:10px}
    .btn.primary{
      background:linear-gradient(135deg,var(--brand), var(--brand-2));
      border:none; color:#fff; box-shadow:0 10px 24px rgba(255,107,181,.25);
    }
    .badges{display:flex; gap:8px; flex-wrap:wrap}
    .badge{
      font-size:12px; font-weight:600; color:#5f5a66; background:#fff; border:1px solid var(--border);
      padding:6px 10px; border-radius:999px
    }
    .item{border:1px solid var(--border); border-radius:14px; padding:12px; background:#fff}
    .item-header{display:flex; align-items:center; gap:10px; justify-content:space-between; margin-bottom:8px}
    .totals{
      display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;
      padding:12px; border:1px dashed var(--border); border-radius:14px; background:linear-gradient(180deg, #fff, #fff7fb);
      font-weight:700; margin-top:12px
    }
    .pill{padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#fff; font-size:13px}
    .success{color:#0c7e46}
    pre{
      white-space:pre-wrap; background:#0f1225; color:#e6e9ff; padding:14px; border-radius:12px; font-size:13px; overflow:auto; margin-top:12px
    }
    .footer-note{font-size:12px; color:var(--muted); margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">
        <!-- Se preferir outra logo, troque o src abaixo -->
        <img src="sandbox:/mnt/data/Black And White Minimalist Typography Personal Logo.svg" alt="Logo">
        <div class="brand-title">Pedidos — Brigadeiros</div>
      </div>
      <div class="badges">
        <span class="badge">Fofo ✓</span>
        <span class="badge">Rápido ✓</span>
        <span class="badge">WhatsApp direto ✓</span>
      </div>
    </div>

    <div class="card">
      <h1>Montar pedido</h1>
      <p class="muted">Adicione <b>Caixinhas (4)</b> e/ou <b>Brigadeiros individuais</b>. Cada caixinha permite 4 sabores (1 por unidade). O individual tem 1 sabor e você define a quantidade.</p>

      <div class="grid row grid-2" style="margin:14px 0 12px">
        <div>
          <label for="clientName">Nome do cliente</label>
          <input id="clientName" type="text" placeholder="Ex.: João Silva" />
        </div>
        <div>
          <label for="deliveryDate">Data da entrega</label>
          <input id="deliveryDate" type="date" />
        </div>
      </div>

      <!-- CAIXINHAS -->
      <div class="section" id="boxSection">
        <div class="inline" style="justify-content:space-between; margin-bottom:8px">
          <h2>Caixinha (4)</h2>
          <button id="addBox" class="btn small">+ Adicionar caixinha</button>
        </div>
        <div id="boxesList" class="grid"></div>
        <p class="muted" style="margin-top:6px">Dica: pode repetir sabores na mesma caixinha se quiser.</p>
      </div>

      <!-- INDIVIDUAIS -->
      <div class="section" id="singleSection" style="margin-top:12px">
        <div class="inline" style="justify-content:space-between; margin-bottom:8px">
          <h2>Brigadeiro individual</h2>
          <button id="addSingle" class="btn small">+ Adicionar individual</button>
        </div>
        <div id="singlesList" class="grid"></div>
      </div>

      <div class="totals">
        <div>Total de unidades: <span id="totalUnits">0</span></div>
        <div class="pill">Caixinhas: <span id="boxCount">0</span></div>
        <div class="pill">Individuais: <span id="singleCount">0</span></div>
      </div>

      <div style="margin-top:14px; display:flex; gap:10px; align-items:center">
        <button id="makeOrder" class="btn primary">Gerar Pedido</button>
        <span class="muted">Enviaremos para <b>+55 11 97313-3475</b> ✨</span>
      </div>

      <div id="outputWrap" style="display:none">
        <h2>Resumo</h2>
        <pre id="orderText"></pre>
        <div class="footer-note">Confira o texto acima — o WhatsApp abre automaticamente com essa mensagem pronta.</div>
      </div>
    </div>
  </div>

  <script>
    // ✅ Seu número fixo (apenas dígitos, sem +):
    const YOUR_WHATS_NUMBER = "5511973133475";

    const FLAVORS = [
      "Tradicional",
      "Ninho com Nutella",
      "Ninho com Uva",
      "Paçoca",
      "Beijinho",
      "Churros",
      "Bicho de Pé",
      "Casadinho",
      "Oreo"
    ];

    // Helpers
    const $ = (s)=>document.querySelector(s);
    const create = (tag, attrs={})=>{
      const el = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v])=>{
        if(k==="class") el.className=v;
        else if(k==="text") el.textContent=v;
        else el.setAttribute(k,v);
      });
      return el;
    };
    const flavorSelect = ()=>{
      const sel = create("select");
      sel.appendChild(new Option("Selecione um sabor...", "", true, true));
      FLAVORS.forEach(f=> sel.appendChild(new Option(f, f)));
      return sel;
    };

    // Datas padrão
    const todayISO = new Date().toISOString().slice(0,10);
    $("#deliveryDate").value = todayISO;

    // Persistir nome do cliente
    const nameInput = $("#clientName");
    nameInput.value = localStorage.getItem("brig_clientName") || "";
    nameInput.addEventListener("input", ()=> localStorage.setItem("brig_clientName", nameInput.value.trim()));

    const boxesList = $("#boxesList");
    const singlesList = $("#singlesList");
    const totalUnitsEl = $("#totalUnits");
    const boxCountEl = $("#boxCount");
    const singleCountEl = $("#singleCount");
    const outputWrap = $("#outputWrap");
    const orderTextPre = $("#orderText");

    // Adiciona uma CAIXINHA (4 sabores) + quantidade (padrão 1)
    function addBox(initial){
      const wrapper = create("div", {class:"item"});
      const header = create("div", {class:"item-header"});
      const title = create("div", {text:"Caixinha (4)"});
      const right = create("div", {class:"inline"});
      const qtyInput = create("input", {type:"number", min:"1", value:(initial?.qty||1)});
      const qtyLabel = create("span", {class:"muted", text:"Qtd."});
      const removeBtn = create("button", {class:"btn small", text:"Remover"});
      right.append(qtyLabel, qtyInput, removeBtn);
      header.append(title, right);

      const grid = create("div", {class:"grid grid-2"});
      const s1 = flavorSelect(), s2 = flavorSelect(), s3 = flavorSelect(), s4 = flavorSelect();
      if(initial?.flavors){ [s1,s2,s3,s4].forEach((s,i)=>{ s.value = initial.flavors[i] || ""; }); }
      grid.append(s1,s2,s3,s4);

      wrapper.append(header, grid);
      boxesList.append(wrapper);

      removeBtn.onclick = ()=>{ wrapper.remove(); recomputeTotals(); };
      [qtyInput,s1,s2,s3,s4].forEach(el=> el.addEventListener("change", recomputeTotals));
      recomputeTotals();
    }

    // Adiciona um INDIVIDUAL (1 sabor) + quantidade
    function addSingle(initial){
      const wrapper = create("div", {class:"item"});
      const header = create("div", {class:"item-header"});
      const title = create("div", {text:"Brigadeiro individual"});
      const right = create("div", {class:"inline"});
      const qtyInput = create("input", {type:"number", min:"1", value:(initial?.qty||1)});
      const qtyLabel = create("span", {class:"muted", text:"Qtd."});
      const removeBtn = create("button", {class:"btn small", text:"Remover"});
      right.append(qtyLabel, qtyInput, removeBtn);
      header.append(title, right);

      const sel = flavorSelect();
      if(initial?.flavor) sel.value = initial.flavor;

      wrapper.append(header, sel);
      singlesList.append(wrapper);

      removeBtn.onclick = ()=>{ wrapper.remove(); recomputeTotals(); };
      [qtyInput, sel].forEach(el=> el.addEventListener("change", recomputeTotals));
      recomputeTotals();
    }

    $("#addBox").onclick = ()=> addBox();
    $("#addSingle").onclick = ()=> addSingle();

    // Comece com 1 caixinha de exemplo
    addBox();

    function getBoxes(){
      return Array.from(boxesList.children).map(box=>{
        const qty = Math.max(1, parseInt(box.querySelector('input[type="number"]').value||"1",10));
        const selects = box.querySelectorAll("select");
        const flavors = Array.from(selects).map(s=> s.value).filter(Boolean);
        return { type:"box", qty, flavors };
      });
    }

    function getSingles(){
      return Array.from(singlesList.children).map(row=>{
        const qty = Math.max(1, parseInt(row.querySelector('input[type="number"]').value||"1",10));
        const flavor = row.querySelector("select").value || "";
        return { type:"single", qty, flavor };
      });
    }

    function recomputeTotals(){
      const boxes = getBoxes();
      const singles = getSingles();
      const boxUnits = boxes.reduce((s,b)=> s + b.qty * 4, 0);
      const singleUnits = singles.reduce((s,i)=> s + i.qty, 0);
      totalUnitsEl.textContent = boxUnits + singleUnits;
      boxCountEl.textContent = boxes.length;
      singleCountEl.textContent = singles.length;
    }

    function ddmmyyyy(iso){
      const [y,m,d] = (iso||"").split("-");
      return (y&&m&&d) ? `${d}/${m}/${y}` : "";
    }

    function buildOrder(){
      const clientName = $("#clientName").value.trim() || "(sem nome)";
      const deliveryDate = $("#deliveryDate").value || "";
      const boxes = getBoxes();
      const singles = getSingles();

      const items = [];
      boxes.forEach((b, idx)=>{
        items.push({ kind:"Caixinha (4)", index:idx+1, qty:b.qty, flavors:b.flavors });
      });
      singles.forEach((s, idx)=>{
        items.push({ kind:"Brigadeiro individual", index:idx+1, qty:s.qty, flavor:s.flavor });
      });

      const totalUnits = boxes.reduce((sum,b)=> sum + b.qty*4, 0) + singles.reduce((sum,i)=> sum + i.qty, 0);

      return {
        clientName,
        deliveryDate,
        deliveryDate_br: ddmmyyyy(deliveryDate),
        boxes, singles, items, totalUnits
      };
    }

    function toText(order){
      const header =
`Pedido de Brigadeiros
Cliente: ${order.clientName}
Data da entrega: ${order.deliveryDate_br || "-"}

`;
      const boxLines = order.boxes.length
        ? order.boxes.map((b,i)=>{
            const list = (b.flavors && b.flavors.length) ? b.flavors.join(", ") : "-";
            return `Caixinha ${i+1} (4): sabores [${list}] — Qtd: ${b.qty} (unid: ${b.qty*4})`;
          }).join("\n")
        : "(sem caixinhas)";

      const singleLines = order.singles.length
        ? order.singles.map((s,i)=> `Individual ${i+1}: ${s.flavor||"-"} — Qtd: ${s.qty}`).join("\n")
        : "(sem individuais)";

      const total = `\nTotal de unidades: ${order.totalUnits}`;
      return `${header}Caixinhas:\n${boxLines}\n\nIndividuais:\n${singleLines}${total}`;
    }

    $("#makeOrder").addEventListener("click", ()=>{
      const order = buildOrder();
      if(order.boxes.length===0 && order.singles.length===0){
        alert("Adicione ao menos 1 caixinha ou 1 individual.");
        return;
      }
      const text = toText(order);
      $("#orderText").textContent = text;
      $("#outputWrap").style.display = "block";

      // Abre WhatsApp
      const url = `https://wa.me/${YOUR_WHATS_NUMBER}?text=${encodeURIComponent(text)}`;
      window.open(url, "_blank");
    });
  </script>
</body>
</html>
